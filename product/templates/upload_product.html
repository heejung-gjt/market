{% extends 'base.html' %}

{% block head %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
{% endblock head %}
{% block content %}

<h1>사진업로드</h1>

<section class="image-section">
  <!-- <div class="image-preview">
</div> -->
<form class="image-form" action="{% url 'product:upload_product' %}" method="POST" enctype="multipart/form-data">
  {% csrf_token %}
  <div class="upload-img">
  <input onchange="setThumbnail(event)" class="image-file upload-img-input" type="file" name="image" multiple width="50"><br>
  <div class="multiple-container"></div>
  <img src="#" alt="이미지 미리보기" class="upload-preview-img" onerror="this.src=`{% static 'img/img5.png' %}`">
</div>
  <select class="image-select" name="category_pk">
    {% for category in category_list %}
    <option value="{{category.pk}}">{{category}}</option>
    {% endfor %}
  </select><br>
  <label for="image-price">가격 :</label>
  <input id="image-price" class="image-price" type="text" name="price"><br>
  <input class="image-name" type="text" name="name" value="제목입력"><br>
  <textarea class="image-content" name="content"placeholder="내용입력"></textarea><br>
  <input class="image-submit" type="submit" value="등록하기" />
  <br></form>
</section>

{% endblock content %}

{% block script %}
<script>
  // 이미지 업로드 기능
const $uploadImgInput = document.querySelector('.upload-img-input');
const $uploadPreviewImg = document.querySelector('.upload-preview-img');
const $multipleContainer = document.querySelector('.multiple-container');

function setThumbnail(event) {
  for(let image of event.target.files){
    let reader = new FileReader();
    reader.onload = function(event){
      let img = document.createElement('img');
      img.setAttribute('src',event.target.result);

      document.querySelector('.multiple-container').appendChild(img);
    }
  
    console.log(image);
    reader.readAsDataURL(image);
  }
}
$uploadPreviewImg.onclick = () =>{
  $uploadImgInput.click();
}

$uploadImgInput.onchange = (e) => {
  const imgFile = e.target.files;
  let fileArr = Array.prototype.slice.call(imgFile)
  for(img of fileArr){
    reader = new FileReader();
    reader.onload = () => {
      $uploadPreviewImg.setAttribute("src", reader.result);
    }
    reader.readAsDataURL(img);
    
  }
}



</script>
{% endblock script %}
