{% extends 'category.html' %}

{% block head %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/product/style.css' %}">
<link rel="stylesheet" href="{% static 'css/filter/style.css' %}">
{% endblock head %}

{% include 'product-nav.html' %}

{% block product-main-title %}
<h1 class="product-main">{{category_title.name}} 제품</h1>
{% endblock product-main-title %}

{% block product-main-content %}

<form class="select-sub-form" action="{% url 'filter:category-sub-list' category_title.pk %}" method="GET">
  <section class="product-social">
    <div class="product-add">
      <span class="product-add-link"><a href="{% url 'product:upload_product' %}">글쓰기</a></span>
    </div>

    <select class="category_detail_select" name="sub_menu_pk">
      <option value="">필터링보기</option>
      <option value="0">전체보기</option>
      {% for sub_menu in category_sub_list.all %}
      <option value="{{sub_menu.pk}}">{{sub_menu.name}}</option>
      {% endfor %}
    </select>
  </section>

</form>
<div class="product-main-flex">
<section class="product-filter">
  <p class="product-filter-title">PRICE RANGE</p>
  <form action="">
    {% csrf_token %}
    <p class="product-filter-start">Price from</p>
    <select name="product-price-start" id="">
      <option value="money">전체금액</option>
      <option value="money">0원</option>
      <option value="money">1000원</option>
      <option value="money">5000원</option>
      <option value="money">10000원</option>
      <option value="money">20000원</option>
      <option value="money">50000원</option>
    </select>
    <p class="product-filter-end">Price to</p>
    <select name="product-price-end" id="">
      <option value="money">전체금액</option>
      <option value="money">10000원</option>
      <option value="money">20000원</option>
      <option value="money">50000원</option>
      <option value="money">100000원</option>
      <option value="money">100000원 이상</option>
    </select>
    <p class="product-category">상세상품</p>
    <select class="category_detail_select" name="sub_menu_pk">
      <option value="0">전체보기</option>
      {% for sub_menu in category_sub_list.all %}
      <option value="{{sub_menu.pk}}">{{sub_menu.name}}</option>
      {% endfor %}
    </select>
    <p class="product-category-sort">상품정렬</p>
    <select class="category_sort_select" name="sub_menu_pk">
      <option value="0">정렬없음</option>
      <option value="0">낮은 가격순</option>
      <option value="0">높은 가격순</option>
      <option value="0">찜 많은 순</option>
      <option value="0">댓글 많은 순</option>
    </select>
    <div class="product-filter-btn">
    <button class="product-filter-reset">초기화</button>
    <button class="product-filter-send" type="submit">검색</button>
  </div>
  </form>
</section>
{% if sub_state and not is_deleted %}
<section class="product-section">
  <ul class="product-list">
    {% for article in articles.all %}
    <a class="product-link" href="{% url 'product:detail' article.pk %}"><li class="product">
      <div class="product-writer">
        <span> <img src="{{article.writer.image_beta}}" alt="" class="product-user-image" onerror="this.src=`{% static 'img/감자.png' %}`"><strong>{{article.writer.nickname}}</strong></span>
    </div>
      <div class="product-imgs">
        <img class="product-img" src="{{article.image}}" alt="">
      </div>
      <span class="product-title">{{article.name}}</span>
      <span class="product-discount">{{article.article_price.discount_rate}}% <i class="fas fa-sort-down"></i></span>
      <strong class="product-price">{{article.price}} 원</strong>
      <div class="social">
        <span class="social-comment">댓글 +{{article.comment.all|length}} </span>
        <span class="social-like"> 찜 +{{article.like.users.all | length}}</span>
      </div>
    </li>
  </a>
    {% endfor %}
  </ul>
</section>
{% else %}
<section class="product-section">
  <ul class="product-list">
    {% for article in category_articles.all %}
    {% if not article.is_deleted %}
    <a class="product-link" href="{% url 'product:detail' article.pk %}"><li class="product">
      <div class="product-writer">
        <span> <img src="{{article.writer.image}}" alt="" class="product-user-image" onerror="this.src=`{% static 'img/감자.png' %}`"><strong>{{article.writer.nickname}}</strong></span>
    </div>
      <div class="product-imgs">
        <img class="product-img" src="{{article.image}}" alt="">
      </div>
      <div class="product-main-page">
      <span class="product-title">{{article.name}}</span>
      <span class="product-discount">{{article.article_price.discount_rate}}% <i class="fas fa-sort-down"></i></span>
      <strong class="product-price">{{article.price}} 원</strong>
      <div class="social">
        <span class="social-comment">댓글 +{{article.comment.all|length}} </span>
        <span class="social-like"> 찜 +{{article.like.users.all | length}}</span>
      </div>
    </div>
    </li>
  </a>
  {% endif %}
    {% endfor %}
  </ul>
</section>
{% endif %}
</div>
{% endblock product-main-content %}





{% block script %}
<script src="/static/filter/script.js" type="text/javascript"></script>

<script>

  document.querySelector('.menu-all').classList.remove('checked');
  document.querySelector('.menu-category').classList.add('checked');

document.querySelector('.select-sub-form').onchange = (e) => {
$selectForm = document.querySelector('.select-sub-form');
$selectForm.submit();
}

</script>
{% endblock script %}
